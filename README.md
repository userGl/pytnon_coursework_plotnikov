## "Микросервис для анализа текста на изображениях (OCR)"
### Курсовая работа студента ТГУ Плотникова Г.А. по предмету "Программирование на Python: углубленный курс"

## 1. Обязательная часть:  
### 1.1. Этапы работа над проектом (общие для всех проектов).  
**Анализ требований:**  
• Определение функциональных требований (обработка изображений с распознаванием лиц).  
• Выбор технологии для распознавания лиц (например, OpenCV или Dlib).  
• Разработка API для получения изображений от пользователей.  
**Разработка backend:**  
• Создание FastAPI сервиса для приема и обработки изображений.  
• Реализация функционала для распознавания лиц с использованием библиотеки OpenCV.  
• Применение паттерна Singleton для управления моделью распознавания лиц.  
**Работа с базой данных:**  
• Проектирование структуры базы данных для хранения изображений и результатов распознавания. 
• Реализация CRUD операций для сохранения и извлечения данных.
**Тестирование и валидация:**  
• Тестирование работы сервиса с различными изображениями.  
• Валидация корректности данных, передаваемых через API  
**Документация и развертывание:**  
• Документирование API и сервиса  

### 1.2. Заданиe на курсовой проект:  
**Решаемые задачи:**   
• Использование библиотеки Tesseract для OCR.  
• Создание API с использованием FastAPI.  
• Валидация данных (Проверка, что изображение содержит текст).  
• Хранение результатов в базе данных и отображение их через frontend.  
Сервис организован на базе web фреймворка FastAPI и Tesseract.  

### 1.3. Инструкции преподавателя от 11.01.2025 (требования для всех проектов):
• **Описание в Readme (что за проект, для чего, как работает, как установить и запустить). - Выполнено**  
• **Использование паттернов программирования. - Выполнено репозиторий**  
• **Тестирование. - Выполнено**  
• **Разделение проекта, структурирование. - Выполнено**  
• **Валидация. - Выполнено**  
• **Шаблоны HTML (рекомендуется не менее 3). - Выполнено**  
• **Наследование шаблонов HTML от базового шаблона base.html - Выполнено**  
• Pandas, если есть смысл его использовать.  
• **Реализация API (чтобы можно было обратиться как с  помощью скрипта, так и со странички HTML). - Выполнено**  

### 1.4. Инструкции преподавателя к текущему проекту от 23.12.2024:
Здравствуйте, в целом мне ваш проект понятен. Было бы здорово если бы вы описали несколько сценариев работы вашего проекта. Какие действия нужно совершить пользователю для решения задачи. 
Например, для распознавания тектса документа на русском языке пользользователь должен вполнить следующие действия:   
1.4.1. Авторизваться/открыть сервис.
1.4.2. Перейти на страницу загрузки документа для распознавания текста.
1.4.3. Загрузить документ с изображения в формате jpg.
1.4.4. Сервис сохраняет загруженный документ в директорию "temp".
1.4.5. Сервис выполняет проверку документа на корректность и в случае успеха запускает процесс распознавания текста.
1.4.6. В результате обработки документа пользователь получает на почту тестовый документ в формате ".docx" в котором находится распознанный текст загруженного документа.
1.4.7. Рекомендую добавить систему логирования чтоб администратор мог просматривать в виде таблицы статистику использования сервиса. Например, названия загруженных документов, размер документа, дату и время загрузки, время обработки документа, имя клиента и почту на которую был выслан результат.

## 2. План работы ПО. Составлен исходя из анализа пунктов 1.1 - 1.4 (может быть дополнен или изменён)
#### Пользователи. Работа программы.
##### 2.1 Администратор
**2.1.1. Добавление/изменение/удаление данных пользователя:**  
• Авторизуется под учётными данными администратора;  
• Заходит на страницу "Пользователи";  
• Добавляет/изменяет/удаляет учётные данные пользователя (login, password, e-mail);  
• Сервис сохраняет/изменяет/удаляет учётные данные пользователя. При удалении пользователя удаляются файлы пользователя из хранилища;  
**2.1.2. Просмотр служебной информации администратором:**  
• Авторизуется под учётными данными администратора; 
• Администратор заходит на страницу "Журнал";  
• Сервис отображает названия загруженных документов, размер документа, дату и время загрузки, время обработки документа, имя пользователя и почту на которую был выслан результат.  

##### 2.2. Пользователь
**2.2.1. Распознование документа:**  
• Пользователь открывает страницу сервиса и авторизуется;  
• **Пользователь переходит на страницу загрузки документа для распознавания текста; - выполнено**  
• **Пользователь загружает документ с изображения в формате jpg; - выполнено**  
• **Сервис сохраняет загруженный документ в директорию "temp"; - выпонено**  
• **Сервис выполняет проверку документа на корректность и в случае успеха запускает процесс распознавания текста; - выполнено** 
• Сервис помещает файл распознаный документ в папку пользователя в хранилище (формат docx). Файл в папке "temp" удаляется;  
• В результате обработки документа пользователь получает на почту тестовый документ в формате ".docx" в котором находится распознанный текст загруженного документа.  

**2.2.2. Просмотр документа:**  
• Пользователь открывает страницу сервиса и авторизуется; 
• Пользователь переходит на страницу сохранённых документов;  
• Сервер отображает список документов пользователя;  
• Пользователь выбирает документ для просмотра/повторной отправки на mail;  
• Сервис отображает/отправляет на mail выбранный документ из хранилища;  

**2.2.3. Удаление документов**  
• Пользователь открывает страницу сервиса и авторизуется;  
• Пользователь переходит на страницу сохранённых документов;  
• Пользователь выбирает файлы для удаления и подтверждает удаление;  
• Сервис удаляет выбранные файлы из хранилища.


#### 3. Установка программы Windows
3.1. В системе должен быть установлен Python 3.13.0  
3.2. Скачайте файлы этого проекта в папку на компьютер. Не используйте кириллицу в пути к папке.  
3.3. Установите виртуальное окружениеие и зависимости. Запустите командную строку в скаченной папке проекта и выполните:  
• python -m venv env  
• env\Scripts\activate  
• pip install -r requirements.txt  
3.4. Скачайте инсталятор "tesseract-ocr-w64-setup-5.5.0.20241111.exe" с сайта:  
https://github.com/UB-Mannheim/tesseract/wiki  
3.5. Запустите инсталятор и в процессе установки выберите:  
• "Additional language data"(download) в меню "Компоненты устанавливаемой программы"  
•  В меню "Выбор папки установки" выберите папку "Tesseract-OCR" которая находится в папке проекта  программы (см. пункт 3.2).   

#### 4. Запуск программы  
Запустите командную строку в скаченной папке проекта и выполните:  
4.1. Активируйте витуальное окружение: Запустите командную строку в папке проекта и выполните env/Scripts/activate  
4.2. Запустите web-сервер, в виртуальном окружении выполните: uvicorn app.main:app  
4.3. Для работы с программой в браузере откройте http://127.0.0.1:8000/my-page  

#### 5. Тестирование
В проекте есть 3 группы тестов:  
5.1 Тесты endpoints (tests/test_endpoints.py):  
• test_root_endpoint - проверка главной страницы "/"  
• test_admin_endpoint - проверка страницы админа "/admin/"  
• test_ocr_endpoint - проверка страницы OCR "/OCR/"  
• test_get_records - проверка получения записей "/records/"
5.2 Тесты базы данных (tests/test_repository.py):  
• test_add_and_get - проверка добавления записи в БД и её получения  
• test_get_by_status - проверка фильтрации записей по статусу (успешные/неуспешные) 
5.3 Тесты OCR (tests/test_ocr_server.py):  
• test_ocr - Tест для проверки распознавания разных типов файлов:  
• test_wrong_type.txt - неправильный формат файла  
• test_no_letters.png - изображение без текста  
• test_text_ok_ru.png - корректный русский текст  
• test_text_ok_en.png - корректный английский текст  
• test_empy_pict.png - пустое изображение  
5.4 Все тесты можно запустить:  
По отдельности через соответствующие кнопки на странице тестирования. 
Все вместе через кнопку "Все тесты".  
Из терминала командой pytest.  
